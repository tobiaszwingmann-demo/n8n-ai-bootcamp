{
  "name": "P3 â€“ Workflow Logic",
  "nodes": [
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"prio\": \"Automated\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -256,
        336
      ],
      "id": "c1b2aa02-cf29-457e-8246-be658af72aa3",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "public": true,
        "authentication": "n8nUserAuth",
        "initialMessages": "Hi there! ðŸ‘‹\nWelcome to our IT support. Please tell us your name to get started:",
        "options": {
          "inputPlaceholder": "Type your name.."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -608,
        112
      ],
      "id": "63b6ded5-0c15-43e7-bc04-eda3e2bde132",
      "name": "When chat message received",
      "webhookId": "220d5913-86d7-43af-8748-3974e2af553b"
    },
    {
      "parameters": {
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        368,
        16
      ],
      "id": "17675835-d34a-4a6c-a2a6-3fbb9d697d87",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "1aa1625c-3a2b-4e9d-8d7c-d8207e03d6f9",
              "leftValue": "={{ $json.output.prio }}",
              "rightValue": "Automated",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -32,
        112
      ],
      "id": "c9e69a46-508d-4e7c-9f81-320b0c3066dd",
      "name": "If"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5-nano",
          "mode": "list",
          "cachedResultName": "gpt-5-nano"
        },
        "options": {
          "reasoningEffort": "low"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -384,
        336
      ],
      "id": "9fdeddeb-fb0f-4e9d-9377-4ed73934ad54",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "vIt4XIujtaBmV5aq",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"Name\": \"Tobias\",\n\t\"Description\": \"My laptop fell down\",\n    \"Response\": \"Sorry to hear that! IT will be in touch shortly!\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        336,
        544
      ],
      "id": "bd8a62ff-22b3-46e8-889b-47e3c6683588",
      "name": "Structured Output Parser2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "267dcef0-9799-47ff-b11a-dca92d81f83b",
              "name": "ID",
              "value": "={{ $now.ts.toString(36).toUpperCase() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        544,
        320
      ],
      "id": "5c5b2d37-64f8-46db-adf4-6bc5c21bab27",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "resource": "file",
        "owner": {
          "__rl": true,
          "value": "tobiaszwingmann",
          "mode": "list",
          "cachedResultName": "tobiaszwingmann",
          "cachedResultUrl": "https://github.com/tobiaszwingmann"
        },
        "repository": {
          "__rl": true,
          "value": "demo-building-ai-workflows-and-agents-with-n8n",
          "mode": "list",
          "cachedResultName": "demo-building-ai-workflows-and-agents-with-n8n",
          "cachedResultUrl": "https://github.com/tobiaszwingmann/demo-building-ai-workflows-and-agents-with-n8n"
        },
        "filePath": "=project 3/tickets/{{ $('Edit Fields').item.json.ID }}.txt",
        "fileContent": "=Prio: {{ $json.output.prio }}\n\nName: {{ $('Ticket Writer').item.json.output.Name }}\n\nSubmitted: {{ $now }}\n\nDescription:\n{{ $('Ticket Writer').item.json.output.Description }}",
        "commitMessage": "new ticket"
      },
      "type": "n8n-nodes-base.github",
      "typeVersion": 1.1,
      "position": [
        1120,
        320
      ],
      "id": "344620c6-3149-4855-9669-29af020cae0c",
      "name": "Create a file",
      "webhookId": "0b3813e2-6615-4593-95c6-35c19c3333ee",
      "credentials": {
        "githubOAuth2Api": {
          "id": "rqkMAdMVwbOGDQB4",
          "name": "GitHub account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"prio\": \"Urgent\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        912,
        544
      ],
      "id": "9c022c85-4f94-489d-80fb-9f6af0a446c0",
      "name": "Structured Output Parser1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1f959a5b-723b-4572-a3ff-f939cca69a85",
              "name": "output",
              "value": "={{ $('Ticket Writer').item.json.output.Response }}\n\nYour Ticket ID is: {{ $('Edit Fields').item.json.ID }}.\n\nThis chat will now be closed. \n\nHave a great day!",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1344,
        320
      ],
      "id": "385ebfa1-070a-42cf-9e77-61451acf3914",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5-nano",
          "mode": "list",
          "cachedResultName": "gpt-5-nano"
        },
        "options": {
          "reasoningEffort": "low"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        176,
        544
      ],
      "id": "a1a689c0-ae14-49cc-bd75-4b79a09e485f",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "vIt4XIujtaBmV5aq",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5-nano",
          "mode": "list",
          "cachedResultName": "gpt-5-nano"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        192,
        16
      ],
      "id": "84ff0717-a813-4473-beec-89765e3ade2d",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "vIt4XIujtaBmV5aq",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('When chat message received').item.json.chatInput }}",
        "options": {
          "systemMessage": "=### **Role**\n\nYou are an **IT Support Chatbot** for a corporate helpdesk.\nYour role is to provide **first-level technical support** to employees who use **Windows** and **Microsoft Office applications** (Word, Excel, Outlook, PowerPoint, Teams, etc.).\n\n### **Your Objectives:**\n1. Ask the user about their name\n2. Understand the userâ€™s problem clearly.\n3. Once the user provided their name and problem , provide **immediate troubleshooting steps** or quick answers when possible. Do not provide help until you know the name and problem.\n\n### **Response Guidelines:**\n* Use short paragraphs or numbered steps.\n* When suggesting commands or settings, write them exactly as they appear in Windows or Office.\n* Ask follow-up questions as needed.\n* If you don't know the answer, say: \"Sorry, I can't help with that.\"\n\n### **Example Response Style:**\n\n**User:** â€œI canâ€™t open Excel files.â€\n**Chatbot:**\n\n> Letâ€™s try a quick fix:\n>\n> 1. Close all Excel windows.\n> 2. Press **Windows + R**, type `excel /safe`, and press **Enter** to open Excel in Safe Mode.\n> 3. Try opening the file again.\n>\n> Did that work? If not, we can check add-ins next or escalate to IT support."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        192,
        -192
      ],
      "id": "05ca254b-2b7e-4c38-8166-81898c3886b7",
      "name": "Chatbot"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('When chat message received').item.json.chatInput }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=Create a ticket given the message history and a response to the user (letting them now that their request has been forwarded to IT and they'll be in touch soon) using the following fields:\n\n- Name: <name of the user>\n- Issue description: <summary of the issue, 1-2 sentences max.>\n- Ticket ID: {{ $json.ID }}\n- Response: <personal response, 1 sentence.>"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        192,
        320
      ],
      "id": "91288f03-dc7c-43dc-9d43-e063d7356b66",
      "name": "Ticket Writer"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Issue:\n\n```\n{{ $('When chat message received').item.json.chatInput }}\n```",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=### **Role**\n\nYou are a text classification system for an IT helpdesk.\nYour task is to decide whether an incoming IT support request can be handled **automatically** by the chatbot or needs to be **routed to a human IT technician**.\n\n### **Default Behavior:**\n\nAssume **all requests can be automated** unless there are clear indicators that human IT support is required.\n\n### **Classification Labels:**\n\n* **Automated** â€” The issue is simple, routine, or can likely be resolved using self-service troubleshooting.\n* **Route to IT** â€” The issue is complex, high-risk, or contains keywords/topics suggesting it requires human involvement.\n\n### **Route to IT** if the request includes **Keywords or topics** such as:\n\n   * *hardware*, *broken*, *damaged*, *replacement*, *repair*\n   * *network down*, *server*, *outage*, *system crash*\n   * *admin rights*, *installation*, *permissions*, *access denied*\n   * *security*, *breach*, *virus*, *phishing*, *data loss*\n   * *urgent*, *critical*, *canâ€™t work*, *system not starting*\n   * *new equipment*, *device setup*, *hardware request*\n   * *user demands human assistance* \n\n### **Otherwise:**\n\nClassify as **Automated** â€” including typical Windows, Office app, network, or login troubleshooting that follows standard steps."
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -384,
        112
      ],
      "id": "54c19476-0821-4634-b1ec-67c8ca90535c",
      "name": "Router"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Issue:\n\n```\n{{ $('Ticket Writer').item.json.output.Description }}\n```",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=**Role**\n\nYou are a text classification system for an IT support helpdesk.\nYour task is to read an incoming support ticket and classify it as either **\"Urgent\"** or **\"Not urgent\"** based on the content.\n\n### Classification Rules:\n\n* **Urgent** if the ticket describes:\n\n  * Complete system or network outages.\n  * Inability to perform critical work tasks.\n  * Security breaches or data loss.\n  * Hardware failure affecting essential operations.\n  * Issues impacting multiple users or key business functions.\n  * Time-sensitive problems needing immediate attention.\n\n* **Not urgent** if the ticket describes:\n\n  * Minor bugs or usability issues.\n  * Requests for information, training, or feature changes.\n  * Scheduled maintenance or non-critical updates.\n  * Problems with available workarounds.\n  * Single-user issues not blocking essential tasks.\n\n### Output Format:\n\nRespond **only** with one of the following labels:\n\n* `Urgent`\n* `Not urgent`\n"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        768,
        320
      ],
      "id": "2d755d85-fd85-4040-9271-1121ccade538",
      "name": "Urgency"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5-nano",
          "mode": "list",
          "cachedResultName": "gpt-5-nano"
        },
        "options": {
          "reasoningEffort": "low"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        720,
        544
      ],
      "id": "a5676885-cb45-4544-a4b3-f8be2510edba",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "vIt4XIujtaBmV5aq",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Router\nDecide whether Chatbot should answer or Ticket should be created for human support",
        "height": 496,
        "width": 368
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -448,
        -16
      ],
      "typeVersion": 1,
      "id": "68466f43-3f19-4ca7-971a-962129d581a7",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Chatbot\nHandle support question automatically",
        "height": 400,
        "width": 704,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        112,
        -272
      ],
      "typeVersion": 1,
      "id": "810e3f26-242a-43eb-bcfa-564d0028af58",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Ticket\nCreate Ticket for human support",
        "height": 464,
        "width": 1536,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        112,
        224
      ],
      "typeVersion": 1,
      "id": "335b0ca5-f41a-4626-96cf-667b8fd4181b",
      "name": "Sticky Note2"
    }
  ],
  "pinData": {},
  "connections": {
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Router",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "Chatbot",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Ticket Writer",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Chatbot",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ticket Writer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Router",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser2": {
      "ai_outputParser": [
        [
          {
            "node": "Ticket Writer",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Urgency",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "Urgency",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Create a file": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Ticket Writer",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Chatbot",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Ticket Writer": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Router": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Urgency": {
      "main": [
        [
          {
            "node": "Create a file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Urgency",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "4ee3a32a-1920-45e8-b631-e75eb843a562",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "94e1edcc34a91a151fc2ec1b99597068a304e37fdb946fc806f00f97776fce3a"
  },
  "id": "NVLxayMKI8kTsl8y",
  "tags": [
    {
      "createdAt": "2025-11-01T20:01:49.551Z",
      "updatedAt": "2025-11-01T20:01:49.551Z",
      "id": "t5Xu6If84iT9d4bw",
      "name": "O'Reilly n8n"
    }
  ]
}